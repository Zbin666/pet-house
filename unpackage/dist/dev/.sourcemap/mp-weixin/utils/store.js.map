{"version":3,"file":"store.js","sources":["utils/store.js"],"sourcesContent":["// 全局状态管理\r\nimport { checkLogin, logout } from './auth.js'\r\n\r\n// 全局状态\r\nconst state = {\r\n  userInfo: null,\r\n  isLoggedIn: false,\r\n  token: null\r\n}\r\n\r\n// 获取状态\r\nexport const getState = () => {\r\n  return { ...state }\r\n}\r\n\r\n// 初始化状态\r\nexport const initState = () => {\r\n  const { isLoggedIn, token, userInfo } = checkLogin()\r\n  \r\n  state.isLoggedIn = isLoggedIn\r\n  state.token = token\r\n  state.userInfo = userInfo\r\n  \r\n  return getState()\r\n}\r\n\r\n// 设置用户信息\r\nexport const setUserInfo = (userInfo) => {\r\n  state.userInfo = userInfo\r\n  state.isLoggedIn = true\r\n}\r\n\r\n// 设置token\r\nexport const setToken = (token) => {\r\n  state.token = token\r\n  state.isLoggedIn = true\r\n}\r\n\r\n// 清除状态\r\nexport const clearState = () => {\r\n  state.userInfo = null\r\n  state.isLoggedIn = false\r\n  state.token = null\r\n}\r\n\r\n// 退出登录\r\nexport const handleLogout = () => {\r\n  clearState()\r\n  logout()\r\n}\r\n\r\n// 检查登录状态\r\nexport const checkAuth = () => {\r\n  const { isLoggedIn } = checkLogin()\r\n  \r\n  if (!isLoggedIn) {\r\n    uni.showModal({\r\n      title: '提示',\r\n      content: '请先登录',\r\n      showCancel: false,\r\n      success: () => {\r\n        uni.reLaunch({\r\n          url: '/pages/login/login'\r\n        })\r\n      }\r\n    })\r\n    return false\r\n  }\r\n  \r\n  return true\r\n}\r\n\r\n// 路由守卫\r\nexport const routeGuard = (to, from, next) => {\r\n  // 需要登录的页面\r\n  const authPages = [\r\n    '/pages/index/index',\r\n    '/pages/user/user',\r\n    '/pages/record/record',\r\n    '/pages/community/community',\r\n    '/pages/settings/setting'\r\n  ]\r\n  \r\n  if (authPages.includes(to.url)) {\r\n    if (!checkAuth()) {\r\n      return\r\n    }\r\n  }\r\n  \r\n  next()\r\n}\r\n"],"names":["checkLogin","logout","uni"],"mappings":";;;AAIA,MAAM,QAAQ;AAAA,EACZ,UAAU;AAAA,EACV,YAAY;AAAA,EACZ,OAAO;AACT;AAGO,MAAM,WAAW,MAAM;AAC5B,SAAO,EAAE,GAAG,MAAO;AACrB;AAGY,MAAC,YAAY,MAAM;AAC7B,QAAM,EAAE,YAAY,OAAO,SAAQ,IAAKA,WAAAA,WAAY;AAEpD,QAAM,aAAa;AACnB,QAAM,QAAQ;AACd,QAAM,WAAW;AAEjB,SAAO,SAAU;AACnB;AAeO,MAAM,aAAa,MAAM;AAC9B,QAAM,WAAW;AACjB,QAAM,aAAa;AACnB,QAAM,QAAQ;AAChB;AAGY,MAAC,eAAe,MAAM;AAChC,aAAY;AACZC,oBAAQ;AACV;AAGY,MAAC,YAAY,MAAM;AAC7B,QAAM,EAAE,WAAY,IAAGD,sBAAY;AAEnC,MAAI,CAAC,YAAY;AACfE,kBAAAA,MAAI,UAAU;AAAA,MACZ,OAAO;AAAA,MACP,SAAS;AAAA,MACT,YAAY;AAAA,MACZ,SAAS,MAAM;AACbA,sBAAAA,MAAI,SAAS;AAAA,UACX,KAAK;AAAA,QACf,CAAS;AAAA,MACF;AAAA,IACP,CAAK;AACD,WAAO;AAAA,EACR;AAED,SAAO;AACT;;;;"}