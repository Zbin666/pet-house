{"version":3,"file":"user.js","sources":["pages/user/user.vue","../../HBuilderX.4.57/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci91c2VyLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"page\" :style=\"dynamicTopPadding\">\n\t\t<!-- 顶部资料卡片 -->\n\t\t<view class=\"profile-card\">\n\t\t\t<image class=\"decor\" src=\"/static/user/icon.png\"></image>\n\t\t\t<view class=\"profile-main\" @tap=\"openSetting\">\n\t\t\t\t<image class=\"avatar\" :src=\"userInfo?.avatarUrl || '/static/logo.png'\" mode=\"aspectFill\"></image>\n\t\t\t\t<view class=\"meta\">\n\t\t\t\t\t<view class=\"row1\">\n\t\t\t\t\t\t<text class=\"uname\">{{ userInfo?.nickname || '用户' }}</text>\n\t\t\t\t\t\t<image class=\"gender\" :src=\"genderIcon\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"stats\">\n\t\t\t\t\t\t<view class=\"stat\"><text class=\"num\">{{ stats.feeds || 0 }}</text><text class=\"label\">动态</text></view>\n\t\t\t\t\t\t<view class=\"divider\"></view>\n\t\t\t\t\t\t<view class=\"stat\"><text class=\"num\">{{ stats.likes || 0 }}</text><text class=\"label\">点赞</text></view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<text class=\"arrow\">›</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 在一起天数条幅 -->\n\t\t<view class=\"ribbon\">\n\t\t\t<image class=\"ribbon-left\" src=\"/static/user/dog.jpg\"></image>\n\t\t\t<text class=\"ribbon-text\">在一起已经 {{ maxTogetherDays }} 天了</text>\n\t\t</view>\n\n\t\t<!-- 我的宠物 -->\n\t\t<view class=\"section pets\">\n\t\t\t<view class=\"title-wrap\"><text class=\"title\">我的宠物</text></view>\n\t\t\t<view class=\"pet-grid\">\n\t\t\t\t<view class=\"pet-card\" v-for=\"p in pets\" :key=\"p.id\" @tap=\"goPetDetail(p)\">\n\t\t\t\t\t<view class=\"pet-avatar-container\">\n\t\t\t\t\t\t<image class=\"pet-avatar\" :src=\"p.avatarUrl || '/static/logo.png'\" mode=\"aspectFill\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"pet-information\">\n\t\t\t\t\t\t<view class=\"pet-name\">\n\t\t\t\t\t\t\t<text>{{ p.name }}</text>\n\t\t\t\t\t\t\t<image class=\"gender sm\" :src=\"p.gender === 'male' ? '/static/user/male.png' : '/static/user/female.png'\"></image>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<text class=\"pet-sub\">{{ formatMeta(p) }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<view class=\"add-pet\" @tap=\"goEdit\">\n\t\t\t\t<!-- <text class=\"plus\">＋</text> -->\n\t\t\t\t<image class=\"plus\" src=\"/static/user/addPet.png\" mode=\"\"></image>\n\t\t\t\t<text class=\"add-text\">添加宠物</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 菜单列表 -->\n\t\t<view class=\"menu\">\n\t\t\t<view class=\"menu-item\" @tap=\"openSetting\">\n\t\t\t\t<image class=\"micon\" src=\"/static/user/setting.png\"></image>\n\t\t\t\t<text class=\"mtext\">设置</text>\n\t\t\t\t<text class=\"arrow\">›</text>\n\t\t\t</view>\n\t\t\t<view class=\"menu-item\" @tap=\"logoutAction\">\n\t\t\t\t<image class=\"micon\" src=\"/static/user/setting.png\"></image>\n\t\t\t\t<text class=\"mtext\">退出登录</text>\n\t\t\t\t<text class=\"arrow\">›</text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { onShow } from '@dcloudio/uni-app'\nimport { initState, checkAuth, handleLogout } from '@/utils/store.js'\nimport { api } from '@/utils/api.js'\n\n// 动态顶部内边距\nconst dynamicTopPadding = ref('')\nonMounted(async () => {\n\ttry {\n\t\tconst info = uni.getSystemInfoSync()\n\t\tconst statusBar = info.statusBarHeight || 0\n\t\tconst screenW = info.screenWidth || 375\n\t\tconst rpxToPx = (rpx) => (rpx * screenW) / 750\n\t\tconst topPx = Math.round(rpxToPx(120) + statusBar)\n\t\tdynamicTopPadding.value = `padding-top:${topPx}px;`\n\t} catch (e) {\n\t\tdynamicTopPadding.value = ''\n\t}\n\t\n\t// 检查登录状态\n\tif (!checkAuth()) {\n\t\treturn\n\t}\n\t\n\t// 初始化状态\n\tconst state = initState()\n\tuserInfo.value = state.userInfo\n\t\n\t// 加载数据\n\tawait loadData()\n})\n\n// 返回到用户页时自动刷新数据\nonShow(async () => {\n\tif (!checkAuth()) return\n\tawait loadData()\n})\n\n// 用户信息\nconst userInfo = ref(null)\nconst pets = ref([])\nconst stats = ref({ feeds: 0, likes: 0 })\nconst maxTogetherDays = ref(0)\n\n// 页面用户性别：'male' | 'female'\nconst gender = ref('female')\nconst genderIcon = computed(() => gender.value === 'male' ? '/static/user/male.png' : '/static/user/female.png')\n\n// 加载数据\nasync function loadData() {\n\ttry {\n\t\t// 加载宠物数据（兼容数组或 {data: []}）\n\t\tconst petsResult = await api.getPets()\n\t\tpets.value = Array.isArray(petsResult) ? petsResult : (petsResult.data || [])\n\t\t\n\t\t// 加载统计数据\n\t\tconst statsResult = await api.getUserStats()\n\t\tstats.value.feeds = statsResult.feeds || 0\n\t\tstats.value.likes = statsResult.likes || 0\n\t\t\n\t\t// 计算最长在一起天数：对所有宠物取 max(days)\n\t\tmaxTogetherDays.value = pets.value.reduce((max, p) => {\n\t\t\tconst start = p.startTogether || p.createdAt\n\t\t\tif (!start) return max\n\t\t\tconst days = Math.max(1, Math.floor((Date.now() - new Date(start).getTime()) / (1000 * 60 * 60 * 24)))\n\t\t\treturn Math.max(max, days)\n\t\t}, 0)\n\t} catch (error) {\n\t\tconsole.error('加载数据失败:', error)\n\t}\n}\n\nfunction goEdit() { uni.navigateTo({ url: '/pages/createPet/createPet' }) }\nfunction openSetting() { uni.navigateTo({ url: '/pages/settings/setting' }) }\nfunction goPetDetail(p) {\n    const payload = encodeURIComponent(JSON.stringify(p))\n    uni.navigateTo({ url: `/pages/petDetail/petDetail?pet=${payload}` })\n}\n\nfunction logoutAction() {\n    uni.showModal({\n        title: '退出登录',\n        content: '确认退出当前账号吗？',\n        success: (res) => {\n            if (res.confirm) {\n                handleLogout()\n            }\n        }\n    })\n}\n\n// 元信息格式化：\"X个月 | Ykg\"\nfunction formatMeta(p) {\n    const months = p?.months ? `${p.months}个月` : ''\n    const weight = p?.weight ? `${p.weight}kg` : ''\n    return [months, weight].filter(Boolean).join(' | ')\n}\n</script>\n\n<style scoped>\n.page {\n\tmin-height: 100vh;\n\tpadding: 24rpx 40rpx;\n\t/* 动态计算顶部间距，避免真机调试时env不生效 */\n\tmin-height: 100vh;\n\tbackground: linear-gradient(180deg, #fff1a8 0%, #fff3c9 32%, #fff7e3 68%, #fffaf1 100%);\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tbox-sizing: border-box;\n}\n\n/* 顶部资料卡 */\n.profile-card {\n\tposition: relative;\n\tmargin-top: 8rpx;\n\twidth: 100%;\n\tmax-width: 704rpx;\n}\n\n.decor {\n\tposition: absolute;\n\tleft: 50%;\n\ttop: -105rpx;\n\ttransform: translateX(-50%);\n\twidth: 120rpx;\n\theight: 120rpx;\n}\n\n.profile-main {\n\theight: 232rpx;\n\tbackground: #fff;\n\tborder-radius: 44rpx;\n\tborder: 4rpx solid #2c2c2c;\n\tpadding: 20rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tposition: relative;\n}\n\n.avatar {\n\tmargin-left: 15rpx;\n\twidth: 160rpx;\n\theight: 160rpx;\n\tborder-radius: 999rpx;\n\tbackground: #f5f5f5;\n}\n\n.meta {\n\tmargin-left: 16rpx;\n\tflex: 1;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 30rpx;\n}\n\n.row1 {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 15rpx;\n}\n\n.uname {\n\tpadding-left: 20rpx;\n\tfont-weight: 700;\n\tfont-size: 34rpx;\n}\n\n.gender {\n\twidth: 32rpx;\n\theight: 32rpx;\n}\n\n.gender.sm {\n\twidth: 26rpx;\n\theight: 26rpx;\n}\n\n.stats {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\twidth: 100%;\n\tmargin-top: 12rpx;\n}\n\n.stat {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tmin-width: 120rpx;\n}\n\n.num {\n\tfont-weight: 800;\n\tfont-size: 33rpx;\n}\n\n.label {\n\tcolor: #666;\n\tfont-size: 24rpx;\n}\n\n.divider {\n\twidth: 4rpx;\n\theight: 56rpx;\n\tbackground: #727171;\n}\n\n.profile-main>.arrow {\n\tposition: absolute;\n\tright: 20rpx;\n\ttop: 12rpx;\n\tfont-size: 40rpx;\n\tfont-weight: 700;\n\tcolor: #2c2c2c;\n}\n\n/* 天数条幅 */\n.ribbon {\n    position: relative;\n    margin: 20rpx 0 22rpx;\n    height: 84rpx;\n    display: flex;\n    align-items: center;\n    background: #fff;\n    border: 4rpx solid #2c2c2c;\n    border-radius: 999rpx;\n    overflow: hidden;\n    width: 100%;\n    max-width: 704rpx;\n}\n\n.ribbon-left {\n    width: 160rpx;\n    height: 100%;\n    object-fit: cover;\n}\n\n.ribbon-text {\n    flex: 1;\n    text-align: center;\n    font-weight: 650;\n    font-size: 30rpx;\n    color: #2c2c2c;\n}\n\n/* 我的宠物 */\n.section.pets {\n\tbackground: #fff;\n\tborder-radius: 24rpx;\n\tborder: 4rpx solid #2c2c2c;\n\tpadding: 16rpx;\n\twidth: 100%;\n\tmax-width: 640rpx;\n}\n\n.title-wrap {\n\tpadding: 8rpx 6rpx 16rpx;\n}\n\n.title {\n\tfont-weight: 750;\n\tfont-size: 32rpx;\n\tbackground: linear-gradient(0deg, #ffe68c, #ffe68c);\n\tpadding: 6rpx 16rpx;\n\tborder-radius: 8rpx;\n}\n\n.pet-grid {\n\tdisplay: grid;\n\tgrid-template-columns: repeat(2, 1fr);\n\tgap: 16rpx;\n\tmargin-top: 12rpx;\n\twidth: 100%;\n}\n\n.pet-card {\n\twidth: 100%;\n\theight: 140rpx;\n\tbackground: #fff;\n\tborder: 4rpx solid #2c2c2c;\n\tborder-radius: 16rpx;\n\tpadding: 12rpx;\n\tdisplay: flex;\n\tbox-sizing: border-box;\n}\n\n.pet-avatar-container {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.pet-avatar {\n\twidth: 94rpx;\n\theight: 94rpx;\n\tborder-radius: 12rpx;\n\tbackground: #f5f5f5;\n}\n\n.pet-information {\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: space-around;\n\tmargin-left: 20rpx;\n}\n\n.pet-name {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 16rpx;\n\tmargin-top: 8rpx;\n\tfont-weight: 700;\n\tfont-size: 28rpx;\n}\n\n.pet-sub {\n\tcolor: #343434;\n\tfont-size: 26rpx;\n}\n\n.add-pet {\n\tmargin-top: 18rpx;\n\tborder: 4rpx dashed #2c2c2c;\n\tborder-radius: 24rpx;\n\theight: 90rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tgap: 12rpx;\n}\n\n.plus {\n\tmargin-top: 5rpx;\n\theight: 35rpx;\n\twidth: 35rpx;\n}\n\n.add-text {\n\tfont-size: 30rpx;\n\tfont-weight: 580;\n}\n\n/* 菜单 */\n.menu {\n\tmargin-top: 16rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 16rpx;\n\twidth: 100%;\n\tmax-width: 704rpx;\n}\n\n.menu-item {\n\tdisplay: flex;\n\talign-items: center;\n\tbackground: #fff;\n\tborder: 4rpx solid #2c2c2c;\n\tborder-radius: 20rpx;\n\tpadding: 18rpx;\n}\n\n.micon {\n\twidth: 78rpx;\n\theight: 78rpx;\n\tmargin-right: 10rpx;\n}\n\n.mtext {\n\tfont-size: 30rpx;\n\tfont-weight: 580;\n\tcolor: #1a1a1a;\n}\n\n.menu-item>.arrow {\n\tmargin-left: auto;\n\tfont-size: 58rpx;\n}\n</style>\n","import MiniProgramPage from 'E:/Uni-App-file/pet-house/pages/user/user.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni","checkAuth","initState","onShow","computed","api","handleLogout"],"mappings":"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"}