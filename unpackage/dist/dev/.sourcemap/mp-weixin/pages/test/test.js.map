{"version":3,"file":"test.js","sources":["pages/test/test.vue","../../HBuilderX.4.57/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdGVzdC90ZXN0LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"test-page\">\n    <view class=\"title\">登录测试页面</view>\n    \n    <view class=\"section\">\n      <text class=\"section-title\">当前状态</text>\n      <view class=\"status\">\n        <text>登录状态: {{ isLoggedIn ? '已登录' : '未登录' }}</text>\n        <text>用户信息: {{ userInfo ? JSON.stringify(userInfo) : '无' }}</text>\n        <text>Token: {{ token ? '有' : '无' }}</text>\n      </view>\n    </view>\n    \n    <view class=\"section\">\n      <text class=\"section-title\">测试按钮</text>\n      <button @tap=\"testWeChatLogin\" :disabled=\"loading\">微信授权登录测试</button>\n      <button @tap=\"testPhoneLogin\" :disabled=\"loading\">手机号登录测试</button>\n      <button @tap=\"testLogout\" :disabled=\"loading\">退出登录</button>\n      <button @tap=\"testAPI\" :disabled=\"loading\">测试API</button>\n    </view>\n    \n    <view class=\"section\">\n      <text class=\"section-title\">API响应</text>\n      <text class=\"response\">{{ apiResponse }}</text>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { initState, handleLogout } from '@/utils/store.js'\nimport { api } from '@/utils/api.js'\nimport { wechatLogin } from '@/utils/wechatAuthNew.js'\nimport { loginWithPhone } from '@/utils/auth.js'\n\nconst isLoggedIn = ref(false)\nconst userInfo = ref(null)\nconst token = ref(null)\nconst loading = ref(false)\nconst apiResponse = ref('')\n\nonMounted(() => {\n  const state = initState()\n  isLoggedIn.value = state.isLoggedIn\n  userInfo.value = state.userInfo\n  token.value = state.token\n})\n\nasync function testWeChatLogin() {\n  loading.value = true\n  try {\n    // 使用微信授权登录，会弹出微信账号选择页面\n    // 注意：这个函数必须在用户直接点击事件中调用\n    await wechatLogin()\n    uni.showToast({ title: '微信授权登录成功', icon: 'success' })\n    // 更新状态\n    const state = initState()\n    isLoggedIn.value = state.isLoggedIn\n    userInfo.value = state.userInfo\n    token.value = state.token\n  } catch (error) {\n    uni.showToast({ title: '微信授权登录失败', icon: 'error' })\n    console.error('微信授权登录失败:', error)\n  } finally {\n    loading.value = false\n  }\n}\n\nasync function testPhoneLogin() {\n  loading.value = true\n  try {\n    await loginWithPhone()\n    uni.showToast({ title: '手机号登录成功', icon: 'success' })\n    // 更新状态\n    const state = initState()\n    isLoggedIn.value = state.isLoggedIn\n    userInfo.value = state.userInfo\n    token.value = state.token\n  } catch (error) {\n    uni.showToast({ title: '手机号登录失败', icon: 'error' })\n    console.error('手机号登录失败:', error)\n  } finally {\n    loading.value = false\n  }\n}\n\nfunction testLogout() {\n  handleLogout()\n  isLoggedIn.value = false\n  userInfo.value = null\n  token.value = null\n  uni.showToast({ title: '已退出登录', icon: 'success' })\n}\n\nasync function testAPI() {\n  loading.value = true\n  try {\n    const result = await api.getProfile()\n    apiResponse.value = JSON.stringify(result, null, 2)\n    uni.showToast({ title: 'API测试成功', icon: 'success' })\n  } catch (error) {\n    apiResponse.value = JSON.stringify(error, null, 2)\n    uni.showToast({ title: 'API测试失败', icon: 'error' })\n    console.error('API测试失败:', error)\n  } finally {\n    loading.value = false\n  }\n}\n</script>\n\n<style scoped>\n.test-page {\n  padding: 20rpx;\n}\n\n.title {\n  font-size: 36rpx;\n  font-weight: bold;\n  text-align: center;\n  margin-bottom: 40rpx;\n}\n\n.section {\n  margin-bottom: 40rpx;\n  padding: 20rpx;\n  border: 2rpx solid #ddd;\n  border-radius: 10rpx;\n}\n\n.section-title {\n  font-size: 28rpx;\n  font-weight: bold;\n  margin-bottom: 20rpx;\n  display: block;\n}\n\n.status {\n  display: flex;\n  flex-direction: column;\n  gap: 10rpx;\n}\n\nbutton {\n  margin: 10rpx 0;\n  padding: 20rpx;\n  background-color: #007aff;\n  color: white;\n  border: none;\n  border-radius: 10rpx;\n}\n\nbutton:disabled {\n  background-color: #ccc;\n}\n\n.response {\n  font-size: 24rpx;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n</style>\n","import MiniProgramPage from 'E:/Uni-App-file/pet-house/pages/test/test.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","initState","wechatLogin","uni","loginWithPhone","handleLogout","api"],"mappings":";;;;;;;;;AAmCA,UAAM,aAAaA,cAAG,IAAC,KAAK;AAC5B,UAAM,WAAWA,cAAG,IAAC,IAAI;AACzB,UAAM,QAAQA,cAAG,IAAC,IAAI;AACtB,UAAM,UAAUA,cAAG,IAAC,KAAK;AACzB,UAAM,cAAcA,cAAG,IAAC,EAAE;AAE1BC,kBAAAA,UAAU,MAAM;AACd,YAAM,QAAQC,YAAAA,UAAW;AACzB,iBAAW,QAAQ,MAAM;AACzB,eAAS,QAAQ,MAAM;AACvB,YAAM,QAAQ,MAAM;AAAA,IACtB,CAAC;AAED,mBAAe,kBAAkB;AAC/B,cAAQ,QAAQ;AAChB,UAAI;AAGF,cAAMC,gCAAa;AACnBC,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,WAAW;AAEpD,cAAM,QAAQF,YAAAA,UAAW;AACzB,mBAAW,QAAQ,MAAM;AACzB,iBAAS,QAAQ,MAAM;AACvB,cAAM,QAAQ,MAAM;AAAA,MACrB,SAAQ,OAAO;AACdE,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,SAAS;AAClDA,sBAAAA,MAAA,MAAA,SAAA,6BAAc,aAAa,KAAK;AAAA,MACpC,UAAY;AACR,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH;AAEA,mBAAe,iBAAiB;AAC9B,cAAQ,QAAQ;AAChB,UAAI;AACF,cAAMC,0BAAgB;AACtBD,sBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,WAAW;AAEnD,cAAM,QAAQF,YAAAA,UAAW;AACzB,mBAAW,QAAQ,MAAM;AACzB,iBAAS,QAAQ,MAAM;AACvB,cAAM,QAAQ,MAAM;AAAA,MACrB,SAAQ,OAAO;AACdE,sBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,SAAS;AACjDA,sBAAAA,MAAA,MAAA,SAAA,6BAAc,YAAY,KAAK;AAAA,MACnC,UAAY;AACR,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH;AAEA,aAAS,aAAa;AACpBE,+BAAc;AACd,iBAAW,QAAQ;AACnB,eAAS,QAAQ;AACjB,YAAM,QAAQ;AACdF,oBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,WAAW;AAAA,IACnD;AAEA,mBAAe,UAAU;AACvB,cAAQ,QAAQ;AAChB,UAAI;AACF,cAAM,SAAS,MAAMG,UAAG,IAAC,WAAY;AACrC,oBAAY,QAAQ,KAAK,UAAU,QAAQ,MAAM,CAAC;AAClDH,sBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,WAAW;AAAA,MACpD,SAAQ,OAAO;AACd,oBAAY,QAAQ,KAAK,UAAU,OAAO,MAAM,CAAC;AACjDA,sBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,SAAS;AACjDA,sBAAAA,MAAA,MAAA,SAAA,8BAAc,YAAY,KAAK;AAAA,MACnC,UAAY;AACR,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH;;;;;;;;;;;;;;;;;;;;AC1GA,GAAG,WAAW,eAAe;"}