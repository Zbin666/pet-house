{"version":3,"file":"petDetail.js","sources":["pages/petDetail/petDetail.vue","../../HBuilderX.4.57/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcGV0RGV0YWlsL3BldERldGFpbC52dWU"],"sourcesContent":["<template>\n\t<view class=\"page\">\n\t\t<!-- 叠纸卡片背景 -->\n\t\t<view class=\"sheet\">\n\t\t\t<view class=\"sheet-bg bg1\"></view>\n\n\t\t\t<view class=\"sheet-body\">\n\t\t\t\t<!-- 头部：头像 + 基本信息列表 -->\n\t\t\t\t<view class=\"header\">\n\t\t\t\t\t<view class=\"avatar-wrap\" @tap=\"editMode ? pickAvatar() : null\">\n\t\t\t\t\t\t<image class=\"avatar\"\n\t\t\t\t\t\t\t:src=\"getPetAvatarSrc(editMode && form.avatarUrl ? form.avatarUrl : pet.avatarUrl)\"\n\t\t\t\t\t\t\tmode=\"aspectFill\" @load=\"onAvatarLoad\" @error=\"onAvatarError\" />\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"kv\">\n\t\t\t\t\t\t<view class=\"kv-row\"><text class=\"k\">姓名：</text>\n\t\t\t\t\t\t\t<template v-if=\"!editMode\"><text class=\"v\">{{ pet.name }}</text></template>\n\t\t\t\t\t\t\t<input v-else class=\"v input\" v-model=\"form.name\" placeholder=\"请输入昵称\" />\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"kv-row\"><text class=\"k\">年龄：</text>\n\t\t\t\t\t\t\t<template v-if=\"!editMode\"><text class=\"v\">{{ pet.months || 0 }}个月</text></template>\n\t\t\t\t\t\t\t<input v-else class=\"v input\" type=\"number\" v-model.number=\"form.months\" placeholder=\"月龄\" />\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"kv-row\"><text class=\"k\">体重：</text>\n\t\t\t\t\t\t\t<template v-if=\"!editMode\"><text class=\"v\">{{ pet.weight || 0 }}kg</text></template>\n\t\t\t\t\t\t\t<input v-else class=\"v input\" type=\"digit\" v-model=\"form.weight\" placeholder=\"kg\" />\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"kv-row\"><text class=\"k\">性别：</text>\n\t\t\t\t\t\t\t<template v-if=\"!editMode\"><text class=\"v\">{{ pet.gender === 'male' ? '男生' : '女生'\n\t\t\t\t\t\t\t}}</text></template>\n\t\t\t\t\t\t\t<picker v-else :range=\"genders\" :value=\"genderIndex\" @change=\"onGenderChange\">\n\t\t\t\t\t\t\t\t<view class=\"picker v\">{{ genders[genderIndex] }}</view>\n\t\t\t\t\t\t\t</picker>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"kv-row\"><text class=\"k\">种类：</text>\n\t\t\t\t\t\t\t<template v-if=\"!editMode\"><text class=\"v\">{{ pet.breed }}</text></template>\n\t\t\t\t\t\t\t<input v-else class=\"v input\" v-model=\"form.breed\" placeholder=\"如 布偶猫\" />\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\n\t\t\t\t<view class=\"edit-row\">\n\t\t\t\t\t<view v-if=\"!editMode\" class=\"edit-actions\">\n\t\t\t\t\t\t<button class=\"btn ghost with-icon\" @tap=\"startEdit\">\n\t\t\t\t\t\t\t<image class=\"btn-icon\" src=\"/static/tarBar/index-active.png\" mode=\"widthFix\" />\n\t\t\t\t\t\t\t<text>编辑</text>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button class=\"btn delete-btn with-icon\" @tap=\"deletePet\">\n\t\t\t\t\t\t\t<image class=\"btn-icon\" src=\"/static/user/delete.png\" mode=\"widthFix\" />\n\t\t\t\t\t\t\t<text>删除</text>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view v-else class=\"edit-actions\">\n\t\t\t\t\t\t<button class=\"btn ghost\" @tap=\"cancelEdit\">取消</button>\n\t\t\t\t\t\t<button class=\"btn\" @tap=\"saveEdit\">保存</button>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\n\t\t\t\t<view class=\"divider-h\"></view>\n\n\t\t\t\t<!-- 绝育 -->\n\t\t\t\t<view class=\"row icon-row\">\n\t\t\t\t\t<image class=\"bullet\" src=\"/static/user/fish.png\" />\n\t\t\t\t\t<text class=\"k big\">是否绝育：</text>\n\t\t\t\t\t<template v-if=\"!editMode\">\n\t\t\t\t\t\t<text class=\"v big\">{{ pet.neutered ? '已绝育' : '未绝育' }}\n\t\t\t\t\t\t</text>\n\t\t\t\t\t</template>\n\t\t\t\t\t<switch v-else class=\"v\" :checked=\"form.neutered\" @change=\"e => form.neutered = e.detail.value\" />\n\t\t\t\t</view>\n\n\t\t\t\t<view class=\"divider-h\"></view>\n\n\t\t\t\t<!-- 疫苗 -->\n\t\t\t\t<view class=\"row icon-row\">\n\t\t\t\t\t<image class=\"bullet\" src=\"/static/user/fish.png\" />\n\t\t\t\t\t<text class=\"k big\">接种疫苗：</text>\n\t\t\t\t\t<view class=\"vaccines\" v-if=\"!editMode\">\n\t\t\t\t\t\t<text v-for=\"(v, i) in vaccines\" :key=\"i\" class=\"v-item\">{{ v }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"vaccines\" v-else>\n\t\t\t\t\t\t<checkbox-group @change=\"onVaccinesChange\">\n\t\t\t\t\t\t\t<label v-for=\"opt in vaccineOptions\" :key=\"opt\" class=\"ck\">\n\t\t\t\t\t\t\t\t<checkbox :value=\"opt\" :checked=\"form.vaccines.includes(opt)\" /><text>{{ opt }}</text>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</checkbox-group>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\n\n\t\t\t\t<view class=\"divider-h\"></view>\n\n\t\t\t\t<!-- 性格 -->\n\t\t\t\t<view class=\"row icon-row\">\n\t\t\t\t\t<image class=\"bullet\" src=\"/static/user/fish.png\" />\n\t\t\t\t\t<text class=\"k big\">性格：</text>\n\t\t\t\t\t<template v-if=\"!editMode\"><text class=\"v big\">{{ temperament }}</text></template>\n\t\t\t\t\t<textarea v-else class=\"v textarea\" v-model=\"form.temperament\" placeholder=\"例如：慵懒，不爱动，还有点小傲娇\" />\n\t\t\t\t</view>\n\n\t\t\t\t<view class=\"divider-h\"></view>\n\n\t\t\t\t<!-- 日常照片 -->\n\t\t\t\t<view class=\"photos\">\n\t\t\t\t\t<view class=\"photos-title\">\n\t\t\t\t\t\t<image class=\"bullet\" src=\"/static/user/fish.png\" />\n\t\t\t\t\t\t<text class=\"k big\">日常照片：</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"gallery\">\n\t\t\t\t\t\t<view v-for=\"(g, i) in editMode ? form.gallery : gallery\"\n\t\t\t\t\t\t\t:key=\"`photo-${i}-${photoUpdateTrigger}`\" class=\"g-wrapper\">\n\t\t\t\t\t\t\t<image class=\"g\" :src=\"getPhotoSrc(g)\" mode=\"aspectFill\" @tap=\"preview(i)\" />\n\t\t\t\t\t\t\t<view v-if=\"editMode\" class=\"g-delete\" @tap=\"deletePhoto(i)\">×</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view v-if=\"editMode\" class=\"g add\" @tap=\"pickGallery\">+</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\n\timport {\n\t\tref,\n\t\tcomputed,\n\t\treactive,\n\t\twatch,\n\t\tnextTick\n\t} from 'vue'\n\timport {\n\t\tonLoad\n\t} from '@dcloudio/uni-app'\n\timport {\n\t\tapi\n\t} from '@/utils/api.js'\n\timport {\n\t\tuploadImage,\n\t\tcompressImage\n\t} from '@/utils/upload.js'\n\n\t// 头像下载缓存，避免重复下载\n\tconst avatarCache = new Map()\n\n\t// 照片缓存\n\tconst photoCache = new Map()\n\tconst photoUpdateTrigger = ref(0)\n\n\tconst pet = ref({})\n\n\t// 规范化后端返回的疫苗数据为数组\n\tfunction normalizeVaccines(val) {\n\t\tif (Array.isArray(val)) {\n\t\t\treturn val\n\t\t}\n\t\tif (typeof val === 'string') {\n\t\t\ttry {\n\t\t\t\tconst parsed = JSON.parse(val)\n\t\t\t\tif (Array.isArray(parsed)) {\n\t\t\t\t\treturn parsed\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t// 可能是逗号分隔的字符串\n\t\t\t}\n\t\t\treturn val\n\t\t\t\t.split(',')\n\t\t\t\t.map(s => s.trim())\n\t\t\t\t.filter(Boolean)\n\t\t}\n\t\treturn []\n\t}\n\n\t// 获取宠物头像的可显示 src（与 user.vue 保持一致）\n\tfunction getPetAvatarSrc(url) {\n\t\tif (!url) return '/static/logo.png'\n\n\t\t// 统一规范化：\n\t\t// 1) /uploads/ 相对路径 → 拼接静态域名\n\t\t// 2) 强制 http → https，去掉 :80\n\t\tlet normalized = url\n\t\tif (normalized.startsWith('/uploads/')) {\n\t\t\tnormalized = `https://pet-api.zbinli.cn${normalized}`\n\t\t}\n\t\tif (normalized.startsWith('http://pet-api.zbinli.cn')) {\n\t\t\tnormalized = normalized.replace('http://pet-api.zbinli.cn', 'https://pet-api.zbinli.cn')\n\t\t}\n\t\tnormalized = normalized.replace('://pet-api.zbinli.cn:80', '://pet-api.zbinli.cn')\n\n\t\t// 本地或静态路径直接返回\n\t\tif (normalized.startsWith('wxfile://') || normalized.startsWith('/static/')) {\n\t\t\treturn normalized\n\t\t}\n\n\t\t// 命中缓存\n\t\tif (avatarCache.has(normalized)) {\n\t\t\treturn avatarCache.get(normalized)\n\t\t}\n\n\t\t// 下载网络图片到本地临时文件\n\t\tuni.downloadFile({\n\t\t\turl: normalized,\n\t\t\tsuccess: (res) => {\n\t\t\t\tif (res.statusCode === 200 && res.tempFilePath) {\n\t\t\t\t\tavatarCache.set(normalized, res.tempFilePath)\n\t\t\t\t\tpet.value = {\n\t\t\t\t\t\t...(pet.value || {})\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tavatarCache.set(normalized, '/static/logo.png')\n\t\t\t\t\tpet.value = {\n\t\t\t\t\t\t...(pet.value || {})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tfail: () => {\n\t\t\t\tavatarCache.set(normalized, '/static/logo.png')\n\t\t\t\tpet.value = {\n\t\t\t\t\t...(pet.value || {})\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\t// 下载中返回占位\n\t\treturn '/static/logo.png'\n\t}\n\n\t// 获取照片的可显示 src\n\tfunction getPhotoSrc(url) {\n\t\tif (!url) return '/static/index/add.png'\n\n\t\t// 统一规范化：\n\t\t// 1) /uploads/ 相对路径 → 拼接静态域名\n\t\t// 2) 强制 http → https，去掉 :80\n\t\tlet normalized = url\n\t\tif (normalized.startsWith('/uploads/')) {\n\t\t\tnormalized = `https://pet-api.zbinli.cn${normalized}`\n\t\t}\n\t\tif (normalized.startsWith('http://pet-api.zbinli.cn')) {\n\t\t\tnormalized = normalized.replace('http://pet-api.zbinli.cn', 'https://pet-api.zbinli.cn')\n\t\t}\n\t\tnormalized = normalized.replace('://pet-api.zbinli.cn:80', '://pet-api.zbinli.cn')\n\n\t\t// 本地或静态路径直接返回\n\t\tif (normalized.startsWith('wxfile://') || normalized.startsWith('/static/')) {\n\t\t\treturn normalized\n\t\t}\n\n\t\t// 命中缓存\n\t\tif (photoCache.has(normalized)) {\n\t\t\treturn photoCache.get(normalized)\n\t\t}\n\n\t\t// 下载网络图片到本地临时文件\n\t\tuni.downloadFile({\n\t\t\turl: normalized,\n\t\t\tsuccess: (res) => {\n\t\t\t\tif (res.statusCode === 200 && res.tempFilePath) {\n\t\t\t\t\tphotoCache.set(normalized, res.tempFilePath)\n\t\t\t\t\tphotoUpdateTrigger.value++\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn('照片下载失败:', normalized, res.statusCode)\n\t\t\t\t\tphotoCache.set(normalized, '/static/index/add.png')\n\t\t\t\t\tphotoUpdateTrigger.value++\n\t\t\t\t}\n\t\t\t},\n\t\t\tfail: (err) => {\n\t\t\t\tconsole.error('照片下载失败:', normalized, err)\n\t\t\t\tphotoCache.set(normalized, '/static/index/add.png')\n\t\t\t\tphotoUpdateTrigger.value++\n\t\t\t}\n\t\t})\n\n\t\treturn '/static/index/add.png'\n\t}\n\n\tonLoad(async (query) => {\n\t\t\t\t// 设置导航栏背景色与页面背景顶部颜色一致\n\t\t\t\tuni.setNavigationBarColor({\n\t\t\t\t\tfrontColor: '#000000',\n\t\t\t\t\tbackgroundColor: '#fff1a8'\n\t\t\t\t})\n\n\t\tif (query?.pet) {\n\t\t\ttry {\n\t\t\t\tconst data = JSON.parse(decodeURIComponent(query.pet))\n\t\t\t\tObject.assign(pet.value, data)\n\t\t\t\t// 同步显示用的疫苗与性格等字段\n\t\t\t\tvaccines.value = normalizeVaccines(data.vaccines)\n\t\t\t\ttemperament.value = data.temperament || ''\n\t\t\t\t\t// 如果路由里带来的数据里疫苗为空，尝试再从后端拉一次最新数据\n\t\t\t\t\tif (!data.vaccines || (Array.isArray(data.vaccines) && data.vaccines.length === 0)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst fresh = await api.getPet(pet.value.id)\n\t\t\t\t\t\tvaccines.value = normalizeVaccines(fresh && fresh.vaccines)\n\t\t\t\t\t\ttemperament.value = (fresh && fresh.temperament) || temperament.value\n\t\t\t\t\t} catch (refreshErr) {\n\t\t\t\t\t\t\t// ignore\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\tnextTick(() => {})\n\t\t\t\tconsole.log('赋值后的pet.value:', pet.value);\n\n\t\t\t\t\t// 测试逻辑移除\n\t\t\t} catch (e) {\n\t\t\t\t\t// ignore\n\t\t\t}\n\t\t}\n\t\t// 拉取该宠物的媒体图片\n\t\tif (pet.value?.id) {\n\t\t\ttry {\n\t\t\t\tconst res = await api.getMedia({\n\t\t\t\t\tpetId: pet.value.id\n\t\t\t\t})\n\t\t\t\tconst mediaList = Array.isArray(res) ? res : (res.media || res.data || [])\n\n\t\t\t\t// 按照创建时间排序（最早到最晚）\n\t\t\t\tconst sortedMediaList = mediaList.sort((a, b) => {\n\t\t\t\t\tconst timeA = new Date(a.createdAt || a.created_at || 0).getTime()\n\t\t\t\t\tconst timeB = new Date(b.createdAt || b.created_at || 0).getTime()\n\t\t\t\t\treturn timeA - timeB // 升序：最早的在前面\n\t\t\t\t})\n\n\t\t\t\t\tgallery.value = sortedMediaList.map(m => m.url).filter(Boolean)\n\t\t\t} catch (err) {\n\t\t\t\t\t// ignore\n\t\t\t}\n\t\t}\n\t})\n\n\tconst recent = ref([{\n\t\t\tid: 'r1',\n\t\t\ttime: '今天 08:00',\n\t\t\ttype: '喂食',\n\t\t\tdesc: '猫粮 60g'\n\t\t},\n\t\t{\n\t\t\tid: 'r2',\n\t\t\ttime: '昨天 21:10',\n\t\t\ttype: '清洁',\n\t\t\tdesc: '铲砂'\n\t\t}\n\t])\n\n\tconst vaccines = ref([])\n\tconst temperament = ref('')\n\tconst gallery = ref([])\n\n\t// 编辑模式\n\tconst editMode = ref(false)\n\tconst genders = ref(['女生', '男生'])\n\tconst genderIndex = ref(1)\n\tconst vaccineOptions = ref([\n\t\t// 猫类常见疫苗\n\t\t'已接种猫三联疫苗',\n\t\t'已接种猫三联第二针/加强',\n\t\t'已接种猫白血病疫苗(FeLV)',\n\t\t'已接种狂犬疫苗',\n\t\t// 犬类常见疫苗\n\t\t'已接种犬五联疫苗',\n\t\t'已接种犬六联疫苗',\n\t\t'已接种犬七联疫苗',\n\t\t'已接种小犬细小疫苗',\n\t\t'已接种犬瘟热疫苗',\n\t\t'已接种博德特氏支气管炎疫苗',\n\t\t'已接种钩端螺旋体疫苗',\n\t\t// 其他\n\t\t'已接种其他疫苗'\n\t])\n\tconst form = reactive({\n\t\tname: '',\n\t\tmonths: '',\n\t\tweight: '',\n\t\tgender: 'male',\n\t\tbreed: '',\n\t\tcolor: '',\n\t\tneutered: false,\n\t\tbirthday: '',\n\t\tstartTogether: '',\n\t\tavatar: '',\n\t\tvaccines: [],\n\t\ttemperament: '',\n\t\tgallery: []\n\t})\n\tconst originalGallery = ref([]) // 保存编辑前的原始照片\n\n\tfunction startEdit() {\n\t\teditMode.value = true\n\t\tObject.assign(form, {\n\t\t\t...pet.value,\n\t\t\tvaccines: [...vaccines.value],\n\t\t\ttemperament: temperament.value,\n\t\t\tavatarUrl: pet.value.avatarUrl,\n\t\t\tgallery: [...gallery.value]\n\t\t})\n\t\toriginalGallery.value = [...gallery.value] // 保存原始照片\n\t\tgenderIndex.value = form.gender === 'male' ? 1 : 0\n\t}\n\n\tfunction cancelEdit() {\n\t\teditMode.value = false\n\t\tgallery.value = [...originalGallery.value] // 恢复原始照片\n\t}\n\tasync function saveEdit() {\n\t\ttry {\n\t\t\tuni.showLoading({\n\t\t\t\ttitle: '保存中...'\n\t\t\t})\n\n\t\t\t// 准备更新数据\n\t\t\tconst updateData = {\n\t\t\t\tname: form.name,\n\t\t\t\tmonths: form.months,\n\t\t\t\tweight: form.weight,\n\t\t\t\tgender: form.gender,\n\t\t\t\tbreed: form.breed,\n\t\t\t\tcolor: form.color,\n\t\t\t\tneutered: form.neutered,\n\t\t\t\tbirthday: form.birthday,\n\t\t\t\tstartTogether: form.startTogether,\n\t\t\t\ttemperament: form.temperament,\n\t\t\t\tvaccines: form.vaccines\n\t\t\t}\n\n\t\t\t// 如果有新头像，需要先上传\n\t\t\tif (form.avatar && form.avatar.startsWith('wxfile://')) {\n\t\t\t\ttry {\n\t\t\t\t\tconst {\n\t\t\t\t\t\tuploadImage,\n\t\t\t\t\t\tcompressImage\n\t\t\t\t\t} = await import('@/utils/upload.js')\n\t\t\t\t\tconst compressedPath = await compressImage(form.avatar, 0.8)\n\t\t\t\t\tconst avatarUrl = await uploadImage(compressedPath, 'avatar')\n\t\t\t\t\tupdateData.avatarUrl = avatarUrl\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.warn('头像上传失败:', error)\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '头像上传失败，其他信息已保存',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t} else if (form.avatarUrl) {\n\t\t\t\tupdateData.avatarUrl = form.avatarUrl\n\t\t\t}\n\n\t\t\t// 更新宠物基本信息\n\t\t\tawait api.updatePet(pet.value.id, updateData)\n\n\t\t\t// 处理照片更新\n\t\t\tconsole.log('🔍 检查照片更新...')\n\t\t\tconsole.log('form.gallery:', form.gallery)\n\t\t\tconsole.log('gallery.value:', gallery.value)\n\n\t\t\tif (form.gallery && form.gallery.length > 0) {\n\t\t\t\t// 检查是否有新添加的照片（本地路径）\n\t\t\t\tconst newPhotos = form.gallery.filter(photo => photo.startsWith('wxfile://'))\n\t\t\t\tconsole.log('新照片数量:', newPhotos.length)\n\t\t\t\tconsole.log('新照片路径:', newPhotos)\n\n\t\t\t\tif (newPhotos.length > 0) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconsole.log('开始上传照片...')\n\n\t\t\t\t\t\t// 压缩并上传新照片\n\t\t\t\t\t\tconst uploadPromises = newPhotos.map(async (photoPath) => {\n\t\t\t\t\t\t\tconsole.log('压缩照片:', photoPath)\n\t\t\t\t\t\t\tconst compressedPath = await compressImage(photoPath, 0.7)\n\t\t\t\t\t\t\tconsole.log('压缩后路径:', compressedPath)\n\t\t\t\t\t\t\tconst uploadedUrl = await uploadImage(compressedPath, 'gallery')\n\t\t\t\t\t\t\tconsole.log('上传成功，URL:', uploadedUrl)\n\t\t\t\t\t\t\treturn uploadedUrl\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tconst uploadedUrls = await Promise.all(uploadPromises)\n\t\t\t\t\t\tconsole.log('所有照片上传完成:', uploadedUrls)\n\n\t\t\t\t\t\t// 创建媒体记录\n\t\t\t\t\t\tconsole.log('创建媒体记录...')\n\t\t\t\t\t\tconsole.log('petId:', pet.value.id)\n\t\t\t\t\t\tconsole.log('urls:', uploadedUrls)\n\n\t\t\t\t\t\tconst mediaResult = await api.createMedia({\n\t\t\t\t\t\t\tpetId: pet.value.id,\n\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\turls: uploadedUrls,\n\t\t\t\t\t\t\tdescription: '宠物照片'\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tconsole.log('媒体记录创建结果:', mediaResult)\n\t\t\t\t\t\tconsole.log('成功上传照片:', uploadedUrls.length, '张')\n\n\t\t\t\t\t\t// 重新从服务器获取排序后的照片列表\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst res = await api.getMedia({\n\t\t\t\t\t\t\t\tpetId: pet.value.id\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tconst mediaList = Array.isArray(res) ? res : (res.media || res.data || [])\n\n\t\t\t\t\t\t\t// 按照创建时间排序（最早到最晚）\n\t\t\t\t\t\t\tconst sortedMediaList = mediaList.sort((a, b) => {\n\t\t\t\t\t\t\t\tconst timeA = new Date(a.createdAt || a.created_at || 0).getTime()\n\t\t\t\t\t\t\t\tconst timeB = new Date(b.createdAt || b.created_at || 0).getTime()\n\t\t\t\t\t\t\t\treturn timeA - timeB // 升序：最早的在前面\n\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\tgallery.value = sortedMediaList.map(m => m.url).filter(Boolean)\n\t\t\t\t\t\t\tconsole.log('保存后重新加载照片，按时间排序:', sortedMediaList.map(m => ({\n\t\t\t\t\t\t\t\turl: m.url,\n\t\t\t\t\t\t\t\tcreatedAt: m.createdAt || m.created_at\n\t\t\t\t\t\t\t})))\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\tconsole.warn('重新加载照片失败，使用本地更新:', err)\n\t\t\t\t\t\t\t// 如果重新加载失败，使用本地更新\n\t\t\t\t\t\t\tconst existingPhotos = form.gallery.filter(photo => !photo.startsWith('wxfile://'))\n\t\t\t\t\t\t\tgallery.value = [...existingPhotos, ...uploadedUrls]\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('照片上传失败:', error)\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '照片上传失败，其他信息已保存',\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('没有新照片需要上传')\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('没有照片需要处理')\n\t\t\t}\n\n\t\t\t// 更新本地数据\n\t\t\tpet.value = {\n\t\t\t\t...pet.value,\n\t\t\t\t...updateData\n\t\t\t}\n\t\t\tvaccines.value = [...form.vaccines]\n\t\t\ttemperament.value = form.temperament\n\t\t\tgallery.value = [...form.gallery]\n\t\t\teditMode.value = false\n\n\t\t\tuni.hideLoading()\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '保存成功',\n\t\t\t\ticon: 'success'\n\t\t\t})\n\n\t\t} catch (error) {\n\t\t\tuni.hideLoading()\n\t\t\tconsole.error('保存失败:', error)\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '保存失败',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t}\n\t}\n\n\tfunction onGenderChange(e) {\n\t\tgenderIndex.value = Number(e.detail.value || 0);\n\t\tform.gender = genderIndex.value === 1 ? 'male' : 'female'\n\t}\n\n\tfunction onVaccinesChange(e) {\n\t\tform.vaccines = e.detail.value || []\n\t}\n\n\tfunction pickAvatar() {\n\t\tuni.chooseImage({\n\t\t\tcount: 1,\n\t\t\tsizeType: ['compressed'],\n\t\t\tsuccess: res => {\n\t\t\t\tform.avatar = res.tempFilePaths[0]\n\t\t\t}\n\t\t})\n\t}\n\n\tfunction pickGallery() {\n\t\tuni.chooseImage({\n\t\t\tcount: 9,\n\t\t\tsizeType: ['compressed'],\n\t\t\tsuccess: res => {\n\t\t\t\tform.gallery = form.gallery.concat(res.tempFilePaths)\n\t\t\t}\n\t\t})\n\t}\n\n\tfunction deletePhoto(index) {\n\t\tif (editMode.value) {\n\t\t\tuni.showModal({\n\t\t\t\ttitle: '确认删除',\n\t\t\t\tcontent: '确定要删除这张照片吗？',\n\t\t\t\tconfirmText: '删除',\n\t\t\t\tcancelText: '取消',\n\t\t\t\tconfirmColor: '#ff4757',\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\tform.gallery.splice(index, 1)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tfunction preview(index) {\n\t\tconst list = editMode.value ? form.gallery : gallery.value\n\t\tif (!Array.isArray(list) || list.length === 0) return\n\t\tuni.previewImage({\n\t\t\tcurrent: index,\n\t\t\turls: list\n\t\t})\n\t}\n\n\tasync function deletePet() {\n\t\tuni.showModal({\n\t\t\ttitle: '确认删除',\n\t\t\tcontent: `确定要删除宠物\"${pet.value.name}\"吗？此操作不可恢复！`,\n\t\t\tconfirmText: '删除',\n\t\t\tcancelText: '取消',\n\t\t\tconfirmColor: '#ff4757',\n\t\t\tsuccess: async (res) => {\n\t\t\t\tif (!res.confirm) return\n\t\t\t\ttry {\n\t\t\t\t\tawait api.deletePet(pet.value.id)\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '宠物已删除',\n\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t})\n\t\t\t\t\t// 通知其他页面刷新\n\t\t\t\t\tuni.$emit && uni.$emit('pets:changed')\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tuni.navigateBack()\n\t\t\t\t\t}, 600)\n\t\t\t\t} catch (e) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '删除失败',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tconst togetherDays = computed(() => {\n\t\tconst start = new Date(pet.value.startTogether).getTime()\n\t\tconst today = new Date().setHours(0, 0, 0, 0)\n\t\treturn Math.max(1, Math.floor((today - start) / 86400000) + 1)\n\t})\n\n\tfunction goEdit() {\n\t\tuni.navigateTo({\n\t\t\turl: '/pages/editPet/editPet'\n\t\t})\n\t}\n\n\tfunction goAlbum() {\n\t\tuni.navigateTo({\n\t\t\turl: '/pages/album/album'\n\t\t})\n\t}\n\n\t// 图片加载事件\n\tfunction onAvatarLoad(e) {}\n\n\tfunction onAvatarError(e) {\n\t\ttry {\n\t\t\te && e.target && (e.target.src = '/static/logo.png')\n\t\t} catch {}\n\t}\n</script>\n\n<style scoped>\n\t.page {\n\t\tmin-height: 100vh;\n\t\tpadding: 24rpx;\n\t\tpadding-top: calc(110rpx + env(safe-area-inset-top));\n\t\tpadding-top: calc(110rpx + constant(safe-area-inset-top));\n\t\tmin-height: 100vh;\n\t\tbackground: linear-gradient(180deg, #fff1a8 0%, #fff3c9 32%, #fff7e3 68%, #fffaf1 100%);\n\t}\n\n\t.sheet {\n\t\tposition: relative;\n\t\tpadding-top: 30rpx;\n\t\tpadding-bottom: 45rpx;\n\t}\n\n\t.sheet-bg {\n\t\tposition: absolute;\n\t\tleft: 12rpx;\n\t\tright: 12rpx;\n\t\theight: 96%;\n\t\tborder: 4rpx solid #2c2c2c;\n\t\tborder-radius: 32rpx;\n\t\tbackground: #fff;\n\t\tz-index: 0;\n\t\tpointer-events: none;\n\t}\n\n\t.sheet-bg.bg1 {\n\t\ttop: 20rpx;\n\t\tbottom: 0;\n\t\t/* 跟随主卡片内容高度变化 */\n\t\theight: 90%;\n\t\t/* 动态高度由 top/bottom 约束 */\n\t\twidth: 630rpx;\n\t\t/* 略小于主体宽度 600rpx，形成叠纸边缘 */\n\t\tleft: 50%;\n\t\tright: auto;\n\t\ttransform: translateX(-50%) rotate(-2.5deg);\n\t}\n\n\t.sheet-body {\n\t\twidth: 600rpx;\n\t\tmargin: 0 auto 40rpx;\n\t\t/* 底部留白，真机可见 */\n\t\tposition: relative;\n\t\tbackground: #fff;\n\t\tborder: 4rpx solid #2c2c2c;\n\t\tborder-radius: 32rpx;\n\t\tpadding: 32rpx 28rpx 120rpx 28rpx;\n\t\tz-index: 1;\n\t}\n\n\t.header {\n\t\tmargin-top: 15rpx;\n\t\tdisplay: flex;\n\t\tgap: 24rpx;\n\t}\n\n\t.avatar-wrap {\n\t\twidth: 272rpx;\n\t\theight: 334rpx;\n\t\tborder: 4rpx solid #2c2c2c;\n\t\tborder-radius: 16rpx;\n\t\tbackground: #f5f5f5;\n\t\toverflow: hidden;\n\t}\n\n\t.avatar {\n\t\twidth: 272rpx;\n\t\theight: 334rpx;\n\t\tborder-radius: 16rpx;\n\t\tbackground: #f5f5f5;\n\t}\n\n\t.kv {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 24rpx;\n\t\tjustify-content: center;\n\t\tmargin-left: 8rpx;\n\t}\n\n\t.kv-row {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 160rpx 1fr;\n\t\talign-items: center;\n\t\tcolumn-gap: 12rpx;\n\t}\n\n\t.k {\n\t\tfont-weight: 700;\n\t\tfont-size: 30rpx;\n\t}\n\n\t.v {\n\t\tfont-size: 30rpx;\n\t}\n\n\t.big {\n\t\tfont-size: 30rpx;\n\t}\n\n\t.input {\n\t\tbackground: #fff;\n\t\tborder: 4rpx solid #2c2c2c;\n\t\tborder-radius: 12rpx;\n\t\tpadding: 10rpx 14rpx;\n\t}\n\n\t.picker {\n\t\tbackground: #fff;\n\t\tborder: 4rpx solid #2c2c2c;\n\t\tborder-radius: 12rpx;\n\t\tpadding: 10rpx 14rpx;\n\t}\n\n\t.textarea {\n\t\twidth: 100%;\n\t\tmax-width: 100%;\n\t\tbox-sizing: border-box;\n\t\tmin-height: 120rpx;\n\t\tborder: 4rpx solid #2c2c2c;\n\t\tborder-radius: 12rpx;\n\t\tpadding: 12rpx 16rpx;\n\t\tbackground: #fff;\n\t}\n\n\t.edit-row {\n\t\tposition: absolute;\n\t\tleft: 28rpx;\n\t\tright: 28rpx;\n\t\tbottom: 28rpx;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\tz-index: 2;\n\t}\n\n\t.edit-actions {\n\t\tdisplay: flex;\n\t\tgap: 28rpx;\n\t}\n\n\t.btn {\n\t\tbackground: #ffe046;\n\t\tcolor: #1a1a1a;\n\t\tborder: 4rpx solid #2c2c2c;\n\t\tborder-radius: 999rpx;\n\t\theight: 72rpx;\n\t\tline-height: 72rpx;\n\t\tpadding: 0 24rpx;\n\t\tfont-weight: 700;\n\t}\n\n\t.btn.ghost {\n\t\tbackground: #fff;\n\t}\n\n\t.btn.with-icon {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tgap: 12rpx;\n\t\tpadding: 0 28rpx;\n\t}\n\n\t.btn-icon {\n\t\twidth: 38rpx;\n\t\theight: 38rpx;\n\t}\n\n\t.btn.delete-btn {\n\t\tbackground: #fff;\n\t\tcolor: #ff4757;\n\t\tborder: 4rpx solid #ff4757;\n\t\tborder-radius: 999rpx;\n\t\theight: 72rpx;\n\t\tline-height: 72rpx;\n\t\tpadding: 0 24rpx;\n\t\tfont-weight: 700;\n\t}\n\n\t.divider-h {\n\t\theight: 2rpx;\n\t\tbackground: #e9e9e9;\n\t\tmargin: 28rpx 0;\n\t}\n\n\t.row {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t}\n\n\t.row.stack {\n\t\tflex-direction: column;\n\t\talign-items: flex-start;\n\t}\n\n\t/* 使用三列网格：图标 / 固定宽度标题 / 值区域 */\n\t.icon-row {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 44rpx var(--label-w, 200rpx) 1fr;\n\t\tcolumn-gap: 12rpx;\n\t\talign-items: start;\n\t}\n\n\t.title {\n\t\tdisplay: contents;\n\t}\n\n\t.icon-row .title {\n\t\tdisplay: contents;\n\t}\n\n\t.icon-row .bullet {\n\t\twidth: 44rpx;\n\t\theight: 44rpx;\n\t\tmargin-right: 12rpx;\n\t}\n\n\t.photos-title .bullet {\n\t\twidth: 44rpx;\n\t\theight: 44rpx;\n\t}\n\n\t.vaccines {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12rpx;\n\t}\n\n\t.vaccines .ck {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tgap: 8rpx;\n\t\tmargin-right: 16rpx;\n\t\tmargin-bottom: 8rpx;\n\t\tfont-size: 26rpx;\n\t}\n\n\t.v-item {\n\t\tfont-size: 30rpx;\n\t}\n\n\t.photos {\n\t\theight: 434rpx;\n\t\tmargin-top: 12rpx;\n\t\tborder: 4rpx solid #2c2c2c;\n\t\tborder-radius: 16rpx;\n\t\tpadding: 18rpx 34rpx;\n\t\tbackground: linear-gradient(180deg, #fff1a8 0%, #fff3c9 32%, #fff7e3 68%, #fffaf1 100%);\n\t\toverflow: hidden;\n\t}\n\n\t.photos-title {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12rpx;\n\t\tmargin-bottom: 12rpx;\n\t}\n\n\t.gallery {\n\t\tpadding-left: 0;\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(3, 176rpx);\n\t\tcolumn-gap: 8rpx;\n\t\trow-gap: 8rpx;\n\t\tmargin-top: 0;\n\t\tjustify-content: start;\n\t\tjustify-items: start;\n\t\tmax-height: calc(2 * 176rpx + 1 * 8rpx);\n\t\toverflow-y: auto;\n\t\t-webkit-overflow-scrolling: touch;\n\t}\n\n\t.g-wrapper {\n\t\tposition: relative;\n\t\twidth: 176rpx;\n\t\theight: 176rpx;\n\t}\n\n\t.g {\n\t\twidth: 176rpx;\n\t\theight: 176rpx;\n\t\tborder-radius: 12rpx;\n\t\tbackground: transparent;\n\t\tborder: 4rpx solid #2c2c2c;\n\t\tbox-sizing: border-box;\n\t}\n\n\t.g.add {\n\t\tbackground: #fff;\n\t\tcolor: #888;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tfont-size: 64rpx;\n\t\tborder: 4rpx solid #2c2c2c;\n\t\tborder-radius: 12rpx;\n\t}\n\n\t.g-delete {\n\t\tposition: absolute;\n\t\ttop: -8rpx;\n\t\tright: -8rpx;\n\t\twidth: 32rpx;\n\t\theight: 32rpx;\n\t\tbackground: #ff4757;\n\t\tcolor: #fff;\n\t\tborder-radius: 50%;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tfont-size: 24rpx;\n\t\tfont-weight: bold;\n\t\tborder: 2rpx solid #fff;\n\t\tbox-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.2);\n\t\tz-index: 10;\n\t}\n</style>","import MiniProgramPage from 'E:/Uni-App-file/pet-house/pages/petDetail/petDetail.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","onLoad","api","nextTick","reactive","compressImage","uploadImage","computed"],"mappings":"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"}