"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/api.js");Math||a();const a=()=>"../../components/CalendarSelector.js",l={__name:"createRecord",setup(a){const l=new Date,n=l.getFullYear(),o=String(l.getMonth()+1).padStart(2,"0"),i=String(l.getDate()).padStart(2,"0"),u=String(l.getHours()).padStart(2,"0"),r=String(l.getMinutes()).padStart(2,"0"),v=e.ref(""),c=e.ref(["日常提醒","洗护提醒","疫苗提醒","用药提醒"]),s=e.ref(0),d=e.ref(`${u}:${r}`),p=e.ref([`${n}-${o}-${i}`]),g=e.ref(!1),f=e.ref([]),m=e.ref([]),h=e.ref("");e.onLoad((async()=>{e.index.setNavigationBarTitle({title:"添加提醒"}),e.index.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#fff1a8"});try{const e=await t.api.getPets(),a=Array.isArray(e)?e:e.data||[];m.value=a,m.value.length>0&&(h.value=m.value[0].id)}catch(a){m.value=[]}}));const S=e.computed((()=>c.value[s.value])),x=e.computed((()=>d.value)),w=e.computed((()=>p.value&&0!==p.value.length?1===p.value.length?p.value[0]:`${p.value[0]} 等${p.value.length}天`:"请选择日期"));function y(e){var t;s.value=Number((null==(t=e.detail)?void 0:t.value)||0)}function T(e){d.value=e.detail.value}function $(){f.value=[...p.value],g.value=!0}function b(){g.value=!1}function _(){p.value=[...f.value],g.value=!1}async function I(){if(!p.value||0===p.value.length)return void e.index.showToast({title:"请选择日期",icon:"none"});if(!h.value)return void e.index.showToast({title:"请先创建宠物",icon:"none"});const a=S.value,l="用药提醒"===a?"medicine":"疫苗提醒"===a?"vaccine":"洗护提醒"===a?"wash":"custom";try{e.index.showLoading({title:"保存中..."});const a=p.value.map((e=>{var a,n;const[o,i]=(d.value||"08:00").split(":").map((e=>parseInt(e,10))),[u,r,c]=e.split("-").map((e=>parseInt(e,10))),s=new Date(u,r-1,c,o||0,i||0,0,0);return t.api.createSubscription({petId:h.value,type:l,fireAt:s.toISOString(),title:(null==(a=v.value)?void 0:a.trim())?v.value.trim().slice(0,40):void 0,content:(null==(n=v.value)?void 0:n.trim())||void 0})}));await Promise.all(a);try{e.index.setStorageSync("lastReminderDraft",{content:v.value,type:S.value,time:d.value,dates:p.value})}catch(n){}e.index.hideLoading(),e.index.showToast({title:"提醒已创建",icon:"success"}),setTimeout((()=>{e.index.setStorageSync("recordTab","stats"),e.index.navigateBack()}),500)}catch(n){e.index.hideLoading(),e.index.showToast({title:"创建失败",icon:"none"})}}return(t,a)=>e.e({a:v.value,b:e.o((e=>v.value=e.detail.value)),c:e.t(S.value),d:c.value,e:s.value,f:e.o(y),g:e.t(w.value),h:e.o($),i:e.t(x.value),j:d.value,k:e.o(T),l:g.value},g.value?{m:e.o((e=>f.value=e)),n:e.p({multiple:!1,modelValue:f.value}),o:e.o(b),p:e.o(_),q:e.o((()=>{})),r:e.o(b)}:{},{s:e.o(I)})}},n=e._export_sfc(l,[["__scopeId","data-v-75fbc6ce"]]);wx.createPage(n);
