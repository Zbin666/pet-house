"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),a=require("../../utils/api.js"),n={__name:"record",setup(n){const i=e.ref("calendar"),l=e.ref(["M","T","W","T","F","S","S"]),o=e.ref(new Date),c=e.ref({y:o.value.getFullYear(),m:o.value.getMonth(),d:o.value.getDate()}),r=e.ref(!0);e.onMounted((()=>{const t=e.index.getStorageSync("recordTab");"calendar"!==t&&"stats"!==t||(i.value=t,e.index.removeStorageSync("recordTab")),k()})),e.onShow((()=>{const t=e.index.getStorageSync("recordTab");"calendar"!==t&&"stats"!==t||(i.value=t,e.index.removeStorageSync("recordTab")),k()})),e.ref([{id:"1",type:"喂食",time:"今天 08:00",desc:"鸡胸+猫粮 50g"},{id:"2",type:"饮水",time:"今天 10:30",desc:"自动饮水机补水"}]),e.ref({feed:9,clean:3,weight:4.2});const u=e.ref([]),d=e.computed((()=>o.value.getFullYear())),s=e.computed((()=>o.value.getMonth())),v=e.computed((()=>{const e=d.value,t=s.value,a=(new Date(e,t,1).getDay()+6)%7,n=new Date(e,t+1,0).getDate(),i=new Date(e,t,0).getDate(),l=[];for(let o=0;o<42;o++){let c,r;o<a?(c=i-a+o+1,r=!1):o<a+n?(c=o-a+1,r=!0):(c=o-a-n+1,r=!1);const u=new Date,d=r&&c===u.getDate()&&t===u.getMonth()&&e===u.getFullYear(),s=r&&c%2==0;l.push({day:c,inMonth:r,isToday:d,hasRecord:s,y:e,m:t})}return l})),g=e.computed((()=>{const e=v.value,t=e.findIndex((e=>e.inMonth&&e.day===c.value.d&&e.m===c.value.m&&e.y===c.value.y)),a=Math.max(0,7*Math.floor((t>=0?t:0)/7));return e.slice(a,a+7)}));function y(){e.index.navigateTo({url:"/pages/createRecord/createRecord"})}const f=e.ref([{key:"eating",title:"饮食",icon:"/static/record/eating.png"},{key:"drinking",title:"饮水",icon:"/static/record/drinking.png",hasValue:!0,value:300,unit:"ml"},{key:"weight",title:"体重",icon:"/static/record/weight.png",hasValue:!0,value:2.5,unit:"kg"},{key:"washing",title:"洗护",icon:"/static/record/washing.png"},{key:"shit",title:"便便",icon:"/static/record/shit.png"},{key:"noting",title:"记事",icon:"/static/record/noting.png"},{key:"abnormal",title:"异常",icon:"/static/record/abnormal.png"},{key:"medicine",title:"用药",icon:"/static/record/medicine.png"}]);function h(e){const t=o.value.getFullYear(),a=o.value.getMonth()+e;o.value=new Date(t,a,1),c.value={y:o.value.getFullYear(),m:o.value.getMonth(),d:1}}function m(e){e.inMonth&&(c.value={y:d.value,m:s.value,d:e.day},k())}function p(e){return e.inMonth&&e.day===c.value.d&&e.m===c.value.m&&e.y===c.value.y}function w(){r.value=!r.value}async function k(){try{const e=c.value.y,t=c.value.m,n=c.value.d,i=new Date(e,t,n,0,0,0).toISOString(),l=new Date(e,t,n,23,59,59,999).toISOString(),o=await a.api.getSubscriptions({startDate:i,endDate:l}),r=Array.isArray(o)?o:o.subscriptions||o.data||[];u.value=r.map((e=>{const t=e.content||("medicine"===e.type?"用药提醒":"vaccine"===e.type?"疫苗提醒":"wash"===e.type?"洗护提醒":"日常提醒"),a="medicine"===e.type?"t4":"vaccine"===e.type?"t3":"wash"===e.type?"t2":"t1";return{id:e.id,type:e.type,typeClass:a,title:t,time:new Date(e.fireAt).toTimeString().slice(0,5),done:"done"===e.state,deleting:!1}}))}catch(e){u.value=[]}}function D(e){const t=u.value.findIndex((t=>t.id===e));-1!==t&&(u.value[t].done=!u.value[t].done)}function S(t){const n=u.value.find((e=>e.id===t));n&&n.deleting?async function(t){const n=u.value.find((e=>e.id===t));if(!n)return;e.index.showModal({title:"确认删除",content:`确定要删除提醒"${n.title}"吗？`,confirmText:"删除",cancelText:"取消",confirmColor:"#ff4757",success:async n=>{if(n.confirm)try{await a.api.deleteSubscription(t),await k(),e.index.$emit&&e.index.$emit("reminders:changed"),e.index.showToast({title:"删除成功",icon:"success"})}catch(i){e.index.showToast({title:"删除失败",icon:"none"})}finally{u.value.forEach((e=>e.deleting=!1))}else u.value.forEach((e=>e.deleting=!1))}})}(t):D(t)}function _(e,t){const a=f.value.find((t=>t.key===e));a&&a.hasValue&&(a.value=parseFloat(t)||0)}return(a,n)=>e.e({a:e.n("calendar"===i.value?"active yellow":""),b:e.o((e=>i.value="calendar")),c:e.n("stats"===i.value?"active yellow":""),d:e.o((e=>i.value="stats")),e:"calendar"===i.value},"calendar"===i.value?{f:t._imports_0$3}:"stats"===i.value?{h:t._imports_0$3}:{},{g:"stats"===i.value,i:e.o((e=>h(-1))),j:e.t(d.value),k:e.t(s.value+1),l:e.o((e=>h(1))),m:e.f(l.value,((t,a,n)=>({a:e.t(t),b:t}))),n:!r.value},r.value?{p:e.f(g.value,((a,n,i)=>e.e({a:p(a)},p(a)?{b:t._imports_0$5}:{},{c:e.t(a.day),d:"w"+n,e:e.n(a.inMonth?"in":"out"),f:e.n(a.isToday?"today":""),g:e.n(p(a)?"selected":""),h:e.o((e=>m(a)),"w"+n)})))}:{o:e.f(v.value,((a,n,i)=>e.e({a:p(a)},p(a)?{b:t._imports_0$5}:{},{c:e.t(a.day),d:n,e:e.n(a.inMonth?"in":"out"),f:e.n(a.isToday?"today":""),g:e.n(p(a)?"selected":""),h:e.o((e=>m(a)),n)})))},{q:r.value?"/static/record/down.png":"/static/record/up.png",r:e.o(w),s:"calendar"===i.value},"calendar"===i.value?{t:e.f(f.value,((t,a,n)=>e.e({a:t.icon,b:e.t(t.title),c:t.hasValue},t.hasValue?e.e({d:"drinking"===t.key},"drinking"===t.key?{e:t.value,f:e.o((e=>_(t.key,e.detail.value)),t.key)}:"weight"===t.key?{h:t.value,i:e.o((e=>_(t.key,e.detail.value)),t.key)}:{},{g:"weight"===t.key,j:e.t(t.unit)}):{},{k:t.key,l:e.o((a=>t.hasValue?null:function(t){const a=c.value.y,n=c.value.m,i=c.value.d,l=new Date(a,n,i,0,0,0),o=new Date(a,n,i,23,59,59,999),r=l.toISOString(),u=o.toISOString();e.index.navigateTo({url:`/pages/recordDetail/recordDetail?type=${t}&startDate=${r}&endDate=${u}`})}(t.key)),t.key)})))}:{},{v:"stats"===i.value},(i.value,{}),{w:"stats"===i.value&&u.value.length},"stats"===i.value&&u.value.length?{x:e.f(u.value,((a,n,i)=>e.e({a:e.n(a.typeClass),b:e.t(a.title),c:e.t(a.time),d:a.deleting},a.deleting?{e:t._imports_0$4}:a.done?{g:t._imports_3$2}:{},{f:a.done,h:a.done?1:"",i:e.o((e=>S(a.id)),a.id),j:a.id,k:e.n({done:a.done,deleting:a.deleting}),l:e.o((e=>(a.id,void u.value.forEach((e=>e.deleting=!0)))),a.id),m:e.o((e=>{return t=a.id,void(u.value.some((e=>e.deleting))?u.value.forEach((e=>e.deleting=!1)):D(t));var t}),a.id)})))}:{},{y:"stats"===i.value&&u.value.length},"stats"===i.value&&u.value.length?{z:t._imports_3$1,A:e.o((e=>y()))}:"stats"===i.value?{C:t._imports_3$1,D:e.o((e=>y()))}:{},{B:"stats"===i.value})}},i=e._export_sfc(n,[["__scopeId","data-v-dceceea0"]]);wx.createPage(i);
