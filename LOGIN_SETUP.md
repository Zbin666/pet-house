# ç™»å½•åŠŸèƒ½å®ç°è¯´æ˜

## ğŸ‰ å·²å®Œæˆçš„åŠŸèƒ½

### 1. åç«¯APIå®ç°
- âœ… ç”¨æˆ·è®¤è¯æ¥å£ (`/api/auth/login`)
- âœ… ç”¨æˆ·èµ„æ–™ç®¡ç† (`/api/users/*`)
- âœ… å®Œæ•´çš„æ•°æ®åº“æ¨¡å‹
- âœ… JWT tokenè®¤è¯
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—

### 2. å‰ç«¯ç™»å½•åŠŸèƒ½
- âœ… å¾®ä¿¡ç™»å½•å®ç°
- âœ… æ‰‹æœºå·ç™»å½•å®ç°
- âœ… ç”¨æˆ·çŠ¶æ€ç®¡ç†
- âœ… ç™»å½•çŠ¶æ€æ£€æŸ¥
- âœ… è‡ªåŠ¨è·³è½¬é€»è¾‘

### 3. ç”¨æˆ·ç•Œé¢æ›´æ–°
- âœ… é¦–é¡µæ˜¾ç¤ºçœŸå®ç”¨æˆ·ä¿¡æ¯
- âœ… ç”¨æˆ·é¡µé¢æ˜¾ç¤ºçœŸå®æ•°æ®
- âœ… ç™»å½•çŠ¶æ€æ£€æŸ¥
- âœ… æµ‹è¯•é¡µé¢

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd pet-house-backend
npm install
npm run prisma:generate
npm run prisma:migrate
npm run dev
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `pet-house-backend/env.example` åˆ° `pet-house-backend/.env` å¹¶é…ç½®ï¼š

```env
DATABASE_URL="mysql://username:password@localhost:3306/pet_house"
JWT_SECRET="your-super-secret-jwt-key-here"
PORT=3000
```

### 3. æµ‹è¯•ç™»å½•åŠŸèƒ½

1. æ‰“å¼€å°ç¨‹åº
2. è¿›å…¥ç™»å½•é¡µé¢
3. ç‚¹å‡»"å¾®ä¿¡ç™»å½•"æˆ–"æ‰‹æœºå·ç™»å½•"
4. æŸ¥çœ‹æµ‹è¯•é¡µé¢ï¼š`/pages/test/test`

## ğŸ“± ç™»å½•æµç¨‹

### å¾®ä¿¡ç™»å½•
1. ç”¨æˆ·ç‚¹å‡»"å¾®ä¿¡ç™»å½•"
2. è°ƒç”¨ `uni.login()` è·å–code
3. è°ƒç”¨ `uni.getUserInfo()` è·å–ç”¨æˆ·ä¿¡æ¯
4. å‘é€åˆ°åç«¯ `/api/auth/login`
5. åç«¯è¿”å›tokenå’Œç”¨æˆ·ä¿¡æ¯
6. ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
7. è·³è½¬åˆ°é¦–é¡µ

### æ‰‹æœºå·ç™»å½•
1. ç”¨æˆ·ç‚¹å‡»"æ‰‹æœºå·ç™»å½•"
2. è°ƒç”¨ `uni.getPhoneNumber()` è·å–æ‰‹æœºå·
3. å‘é€åˆ°åç«¯ `/api/auth/login`
4. åç«¯è¿”å›tokenå’Œç”¨æˆ·ä¿¡æ¯
5. ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
6. è·³è½¬åˆ°é¦–é¡µ

## ğŸ”§ APIæ¥å£

### ç™»å½•æ¥å£
```javascript
POST /api/auth/login
{
  "code": "å¾®ä¿¡codeæˆ–æ‰‹æœºå·code",
  "nickname": "ç”¨æˆ·æ˜µç§°",
  "avatarUrl": "å¤´åƒURL"
}

// å“åº”
{
  "token": "jwt-token",
  "user": {
    "id": "user-id",
    "nickname": "ç”¨æˆ·æ˜µç§°",
    "avatarUrl": "å¤´åƒURL"
  }
}
```

### ç”¨æˆ·èµ„æ–™æ¥å£
```javascript
GET /api/auth/profile
// å“åº”ï¼šç”¨æˆ·è¯¦ç»†ä¿¡æ¯

PUT /api/users/profile
{
  "nickname": "æ–°æ˜µç§°",
  "avatarUrl": "æ–°å¤´åƒ"
}
```

## ğŸ› ï¸ å¼€å‘è¯´æ˜

### æ–‡ä»¶ç»“æ„
```
pet-house/
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ api.js          # APIè°ƒç”¨å°è£…
â”‚   â”œâ”€â”€ auth.js         # è®¤è¯ç›¸å…³å‡½æ•°
â”‚   â””â”€â”€ store.js        # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ login/login.vue # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ index/index.vue # é¦–é¡µ
â”‚   â”œâ”€â”€ user/user.vue   # ç”¨æˆ·é¡µé¢
â”‚   â””â”€â”€ test/test.vue   # æµ‹è¯•é¡µé¢
```

### å…³é”®å‡½æ•°

#### ç™»å½•å‡½æ•°
```javascript
import { loginWithWeChat, loginWithPhone } from '@/utils/auth.js'

// å¾®ä¿¡ç™»å½•
await loginWithWeChat()

// æ‰‹æœºå·ç™»å½•
await loginWithPhone()
```

#### çŠ¶æ€ç®¡ç†
```javascript
import { initState, checkAuth } from '@/utils/store.js'

// åˆå§‹åŒ–çŠ¶æ€
const state = initState()

// æ£€æŸ¥ç™»å½•çŠ¶æ€
if (!checkAuth()) {
  // è·³è½¬åˆ°ç™»å½•é¡µ
}
```

#### APIè°ƒç”¨
```javascript
import { api } from '@/utils/api.js'

// è·å–ç”¨æˆ·ä¿¡æ¯
const profile = await api.getProfile()

// è·å–å® ç‰©åˆ—è¡¨
const pets = await api.getPets()
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. ç™»å½•å¤±è´¥
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨
- æ£€æŸ¥APIåœ°å€æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### 2. å¾®ä¿¡ç™»å½•å¤±è´¥
- ç¡®ä¿åœ¨å°ç¨‹åºç¯å¢ƒä¸­æµ‹è¯•
- æ£€æŸ¥å¾®ä¿¡å¼€å‘è€…å·¥å…·é…ç½®
- ç¡®è®¤å·²åŒæ„ç”¨æˆ·åè®®

### 3. æ‰‹æœºå·ç™»å½•å¤±è´¥
- ç¡®ä¿åœ¨å°ç¨‹åºç¯å¢ƒä¸­æµ‹è¯•
- æ£€æŸ¥æ‰‹æœºå·æˆæƒé…ç½®

### 4. APIè°ƒç”¨å¤±è´¥
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æ£€æŸ¥tokenæ˜¯å¦æœ‰æ•ˆ
- æŸ¥çœ‹åç«¯æ—¥å¿—

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½®çœŸå®çš„å¾®ä¿¡API
2. **å®‰å…¨**ï¼šJWTå¯†é’¥éœ€è¦ä¿å¯†ï¼Œä¸è¦æäº¤åˆ°ä»£ç ä»“åº“
3. **æ•°æ®åº“**ï¼šç¡®ä¿MySQLæœåŠ¡è¿è¡Œï¼Œæ•°æ®åº“å·²åˆ›å»º
4. **è·¨åŸŸ**ï¼šå¼€å‘ç¯å¢ƒå·²é…ç½®CORSï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½®åŸŸåç™½åå•

## ğŸ¯ ä¸‹ä¸€æ­¥

1. é…ç½®ç”Ÿäº§ç¯å¢ƒ
2. é›†æˆçœŸå®çš„å¾®ä¿¡API
3. æ·»åŠ æ›´å¤šç”¨æˆ·åŠŸèƒ½
4. å®Œå–„é”™è¯¯å¤„ç†
5. æ·»åŠ å•å…ƒæµ‹è¯•
